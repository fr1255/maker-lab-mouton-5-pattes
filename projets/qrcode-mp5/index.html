<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>QR Code SVG natif (yeux + modules arrondis) + PNG | Maker Lab</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root{
      --bg:#0b0f14;
      --card:#111824;
      --text:#e7eef7;
      --muted:#a9b4c4;
      --line:rgba(255,255,255,.12);
      --accent:#58a6ff;
      --radius:16px;
      --max:1100px;
      --accent-rgb: 88,166,255;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0; font-family:system-ui, sans-serif;
      background:var(--bg); color:var(--text); line-height:1.55;
    }
    header{ position:fixed; top:0; right:0; padding:16px 24px; z-index:10; }
    nav a{
      margin-left:8px; padding:6px 12px; border-radius:999px;
      border:1px solid rgba(255,255,255,.25);
      text-decoration:none; color:var(--text); font-size:14px;
    }
    nav a:hover{ border-color:var(--accent); }

    .wrap{ max-width:var(--max); margin:auto; padding:96px 16px 72px; }
    a{ color:var(--accent); text-decoration:none; }
    a:hover{ text-decoration:underline; }

    .hero{
      background:linear-gradient(180deg, rgba(var(--accent-rgb), .10), transparent 60%);
      border:1px solid var(--line);
      border-radius:calc(var(--radius) + 4px);
      padding:22px;
    }
    .kicker{ color:var(--muted); font-size:14px; margin:0 0 6px; }
    h1{ margin:0 0 10px; font-size:28px; }
    .lead{ margin:0; color:var(--muted); max-width:90ch; }

    .grid{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap:16px; margin-top:16px;
    }
    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--radius);
      padding:18px;
    }
    .card h2{ margin:0 0 8px; font-size:18px; }
    .card p{ margin:0; color:var(--muted); font-size:14px; }

    .actions{ display:flex; flex-wrap:wrap; gap:10px; margin-top:14px; align-items:center; }
    .btn{
      display:inline-block; padding:10px 14px; border-radius:999px;
      border:1px solid rgba(255,255,255,.25);
      color:var(--text); font-size:14px;
      background:transparent; cursor:pointer;
    }
    .btn:hover{ border-color:var(--accent); }
    .btn.primary{
      border-color:rgba(var(--accent-rgb), .55);
      background:rgba(var(--accent-rgb), .10);
    }

    label{ display:block; color:var(--muted); font-size:13px; margin:10px 0 6px; }
    input[type="text"], select, input[type="color"], input[type="file"]{
      width:100%; padding:10px 12px; border-radius:12px;
      border:1px solid rgba(255,255,255,.18);
      background:#0e1520; color:var(--text);
      font-size:15px; outline:none;
    }
    input[type="text"]:focus, select:focus, input[type="color"]:focus, input[type="file"]:focus{
      border-color:rgba(var(--accent-rgb), .55);
      box-shadow:0 0 0 3px rgba(var(--accent-rgb), .12);
    }

    .row2{ display:grid; grid-template-columns:1fr 1fr; gap:12px; }
    @media (max-width: 720px){ .row2{ grid-template-columns:1fr; } }

    .qrBox{
      background:rgba(255,255,255,.03);
      border:1px dashed rgba(255,255,255,.18);
      border-radius:14px;
      padding:16px;
      display:flex;
      align-items:center;
      justify-content:center;
      min-width:260px;
      min-height:260px;
      overflow:hidden;
    }
    .qrBox svg{ width:100%; height:auto; display:block; }

    .qrHint{ margin-top:10px; color:var(--muted); font-size:13px; max-width:80ch; }
    .tiny{ font-size:12px; color:var(--muted); margin-top:6px; }

    .pdfWrap{
      margin-top:20px; background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--radius);
      overflow:hidden;
    }
    .pdfHeader{
      padding:12px 14px; border-bottom:1px solid var(--line);
      display:flex; justify-content:space-between; gap:10px;
      font-size:13px; color:var(--muted); flex-wrap:wrap;
    }
    .pdfFrame{
      width:100%; min-height:420px; border:0;
      background:#000; display:flex; align-items:center; justify-content:center;
      padding:18px;
    }
    footer{
      margin-top:26px; color:var(--muted); font-size:13px;
      border-top:1px solid var(--line); padding-top:16px;
    }
  </style>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode-generator/1.4.4/qrcode.min.js"></script>
</head>

<body>
<header>
  <nav>
    <a href="/maker-lab-mouton-5-pattes/">Accueil</a>
    <a href="/maker-lab-mouton-5-pattes/projets/">Projets</a>
    <a href="/maker-lab-mouton-5-pattes/journal/">Journal</a>
    <a href="/maker-lab-mouton-5-pattes/#contact">Contact</a>
  </nav>
</header>

<div class="wrap">
  <div class="hero">
    <p class="kicker">üßæüì∑ Outil ‚Ä¢ G√©n√©rateur</p>
    <h1>QR Code SVG natif ‚Äî yeux + modules arrondis + export PNG</h1>
    <p class="lead">
      SVG vectoriel (impression parfaite) + export PNG haute d√©finition (rasterisation du SVG).
    </p>

    <div class="grid">
      <div class="card">
        <h2>Entr√©e</h2>

        <label for="text">Texte / URL</label>
        <input id="text" type="text" value="https://example.com" placeholder="https://‚Ä¶" />

        <div class="row2">
          <div>
            <label for="size">Taille (px) ‚Äî calage grille</label>
            <select id="size">
              <option value="256">256</option>
              <option value="384">384</option>
              <option value="512" selected>512</option>
              <option value="768">768</option>
              <option value="1024">1024</option>
            </select>
          </div>
          <div>
            <label for="eclevel">Correction</label>
            <select id="eclevel">
              <option value="L">L (‚âà7%)</option>
              <option value="M">M (‚âà15%)</option>
              <option value="Q">Q (‚âà25%)</option>
              <option value="H" selected>H (‚âà30%)</option>
            </select>
          </div>
        </div>

        <div class="row2">
          <div>
            <label for="colorDark">Couleur du QR</label>
            <input id="colorDark" type="color" value="#e7eef7" />
          </div>
          <div>
            <label for="colorLight">Couleur de fond</label>
            <input id="colorLight" type="color" value="#0b0f14" />
          </div>
        </div>

        <div class="row2">
          <div>
            <label for="quietZone">Quiet zone (modules)</label>
            <select id="quietZone">
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4" selected>4 (standard)</option>
              <option value="5">5</option>
              <option value="6">6</option>
            </select>
          </div>
          <div>
            <label for="eyeRound">Arrondi des yeux</label>
            <select id="eyeRound">
              <option value="0.30">Normal</option>
              <option value="0.38" selected>Doux</option>
              <option value="0.48">Tr√®s doux</option>
            </select>
          </div>
        </div>

        <div class="row2">
          <div>
            <label for="roundModules">Modules arrondis ?</label>
            <select id="roundModules">
              <option value="off" selected>Non (max fiabilit√©)</option>
              <option value="on">Oui</option>
            </select>
            <div class="tiny">Conseil : ‚ÄúNon‚Äù si QR dense / imprim√© petit.</div>
          </div>
          <div>
            <label for="moduleRoundness">Intensit√© arrondi modules</label>
            <select id="moduleRoundness">
              <option value="0.10">Tr√®s l√©ger</option>
              <option value="0.18" selected>L√©ger</option>
              <option value="0.28">Moyen</option>
              <option value="0.38">Fort</option>
            </select>
          </div>
        </div>

        <div class="row2">
          <div>
            <label for="logoFile">Logo (optionnel)</label>
            <input id="logoFile" type="file" accept="image/png,image/svg+xml,image/jpeg,image/webp" />
            <div class="tiny">Logo SVG = reste vectoriel dans l‚Äôexport SVG.</div>
          </div>
          <div>
            <label for="logoSize">Taille du logo (%)</label>
            <select id="logoSize">
              <option value="18">18 %</option>
              <option value="20">20 %</option>
              <option value="22">22 %</option>
              <option value="25" selected>25 %</option>
              <option value="28">28 %</option>
              <option value="30">30 %</option>
            </select>
          </div>
        </div>

        <div class="row2">
          <div>
            <label for="logoBgMode">Fond du logo</label>
            <select id="logoBgMode">
              <option value="auto" selected>Auto (blanc)</option>
              <option value="custom">Couleur choisie</option>
              <option value="transparent">Transparent</option>
            </select>
          </div>
          <div>
            <label for="logoBg">Couleur fond (si ‚Äúcouleur choisie‚Äù)</label>
            <input id="logoBg" type="color" value="#ffffff" />
          </div>
        </div>

        <div class="row2">
          <div>
            <label for="logoBgShape">Forme du fond</label>
            <select id="logoBgShape">
              <option value="square">Carr√©</option>
              <option value="rounded" selected>Arrondi</option>
              <option value="circle">Cercle</option>
            </select>
          </div>
          <div>
            <label for="logoBgRound">Arrondi (si ‚Äúarrondi‚Äù)</label>
            <select id="logoBgRound">
              <option value="18" selected>18 %</option>
              <option value="25">25 %</option>
              <option value="35">35 %</option>
              <option value="50">50 %</option>
            </select>
          </div>
        </div>

        <div class="row2">
          <div>
            <label for="pngScale">Export PNG ‚Äî √©chelle</label>
            <select id="pngScale">
              <option value="1">x1</option>
              <option value="2" selected>x2 (recommand√©)</option>
              <option value="4">x4 (tr√®s HD)</option>
            </select>
            <div class="tiny">PNG = rasterisation du SVG (plus l‚Äô√©chelle est grande, plus c‚Äôest net).</div>
          </div>
          <div>
            <label>&nbsp;</label>
            <div class="tiny">Astuce : pour impression pro ‚Üí export SVG.</div>
          </div>
        </div>

        <div class="actions" style="margin-top:14px;">
          <button class="btn primary" id="btnGenerate">G√©n√©rer</button>
          <button class="btn" id="btnDownloadSvg">T√©l√©charger SVG</button>
          <button class="btn" id="btnDownloadPng">T√©l√©charger PNG</button>
          <button class="btn" id="btnReset">R√©initialiser</button>
        </div>

        <p class="qrHint" id="hint">‚Äî</p>
      </div>

      <div class="card">
        <h2>Aper√ßu (SVG)</h2>
        <p>Vectoriel (zoom infini).</p>
        <div style="margin-top:14px;">
          <div class="qrBox"><div id="qrcodeSmall"></div></div>
        </div>
      </div>
    </div>

    <div class="actions">
      <a class="btn" href="../">‚Üê Retour</a>
      <a class="btn" href="#" id="btnCopy">Copier le texte</a>
    </div>
  </div>

  <div class="pdfWrap">
    <div class="pdfHeader">
      <span>üì¶ Sortie (grand format)</span>
      <span id="status">Pr√™t.</span>
    </div>

    <div class="pdfFrame">
      <div style="text-align:center;">
        <div class="qrBox"><div id="qrcodeBig"></div></div>
        <div class="qrHint">Export : SVG autonome + PNG HD.</div>
      </div>
    </div>
  </div>

  <footer>Maker Lab du Mouton √† 5 Pattes ‚Äî Outil ¬´ QR SVG natif ¬ª</footer>
</div>

<script>
  const elText = document.getElementById("text");
  const elSize = document.getElementById("size");
  const elEC   = document.getElementById("eclevel");
  const elDark = document.getElementById("colorDark");
  const elLight= document.getElementById("colorLight");
  const elQuiet= document.getElementById("quietZone");
  const elEyeRound = document.getElementById("eyeRound");

  const elRoundModules = document.getElementById("roundModules");
  const elModuleRound  = document.getElementById("moduleRoundness");

  const elLogoFile    = document.getElementById("logoFile");
  const elLogoSize    = document.getElementById("logoSize");
  const elLogoBgMode  = document.getElementById("logoBgMode");
  const elLogoBg      = document.getElementById("logoBg");
  const elLogoBgShape = document.getElementById("logoBgShape");
  const elLogoBgRound = document.getElementById("logoBgRound");

  const elPngScale = document.getElementById("pngScale");

  const btnGenerate    = document.getElementById("btnGenerate");
  const btnDownloadSvg = document.getElementById("btnDownloadSvg");
  const btnDownloadPng = document.getElementById("btnDownloadPng");
  const btnReset       = document.getElementById("btnReset");
  const btnCopy        = document.getElementById("btnCopy");

  const statusEl = document.getElementById("status");
  const hintEl   = document.getElementById("hint");

  const boxSmall = document.getElementById("qrcodeSmall");
  const boxBig   = document.getElementById("qrcodeBig");

  function clearNode(node){ while(node.firstChild) node.removeChild(node.firstChild); }

  // Logo as DataURL
  let logoDataUrl = "";
  let logoEnabled = false;

  function escAttr(s){
    return String(s)
      .replace(/&/g,"&amp;").replace(/</g,"&lt;")
      .replace(/>/g,"&gt;")
      .replace(/"/g,"&quot;");
  }

  function svgRoundRectPath(x,y,w,h,r){
    const rr = Math.max(0, Math.min(r, Math.min(w,h)/2));
    return [
      `M ${x+rr} ${y}`,
      `H ${x+w-rr}`,
      `A ${rr} ${rr} 0 0 1 ${x+w} ${y+rr}`,
      `V ${y+h-rr}`,
      `A ${rr} ${rr} 0 0 1 ${x+w-rr} ${y+h}`,
      `H ${x+rr}`,
      `A ${rr} ${rr} 0 0 1 ${x} ${y+h-rr}`,
      `V ${y+rr}`,
      `A ${rr} ${rr} 0 0 1 ${x+rr} ${y}`,
      `Z`
    ].join(" ");
  }
  function svgRect(x,y,w,h,fill){
    return `<rect x="${x}" y="${y}" width="${w}" height="${h}" fill="${escAttr(fill)}"/>`;
  }
  function svgPath(d, fill){
    return `<path d="${escAttr(d)}" fill="${escAttr(fill)}"/>`;
  }

  // Finder + separator area (8x8) excluded
  function inFinderOrSeparatorArea(r,c,n){
    const inTL = (r <= 7 && c <= 7);
    const inTR = (r <= 7 && c >= n-8);
    const inBL = (r >= n-8 && c <= 7);
    return inTL || inTR || inBL;
  }

  function countDarkNeighbors(qr, r, c, n){
    let cnt = 0;
    const dirs = [[-1,0],[1,0],[0,-1],[0,1]];
    for (const [dr,dc] of dirs){
      const rr = r+dr, cc=c+dc;
      if (rr<0 || cc<0 || rr>=n || cc>=n) continue;
      if (qr.isDark(rr,cc)) cnt++;
    }
    return cnt;
  }

  function drawEyes(parts, startX, startY, m, n, dark, light){
    const eye = 7*m;
    const eyeRoundRatio = parseFloat(elEyeRound.value || "0.38");
    const outerR = Math.round(eyeRoundRatio * eye);
    const innerR = Math.round(0.22 * eye);

    const pos = [
      {x:startX, y:startY},
      {x:startX + (n-7)*m, y:startY},
      {x:startX, y:startY + (n-7)*m}
    ];

    for (const p of pos){
      parts.push(svgRect(p.x, p.y, eye, eye, light));
      parts.push(svgPath(svgRoundRectPath(p.x, p.y, eye, eye, outerR), dark));
      parts.push(svgPath(svgRoundRectPath(p.x + m, p.y + m, 5*m, 5*m, Math.max(0, outerR - m)), light));
      parts.push(svgPath(svgRoundRectPath(p.x + 2*m, p.y + 2*m, 3*m, 3*m, innerR), dark));
    }
  }

  function drawLogo(parts, qrPx){
    if (!logoEnabled || !logoDataUrl) return;

    const percent = parseInt(elLogoSize.value, 10) || 25;
    const s = Math.round(qrPx * (percent/100));
    const x = Math.round((qrPx - s)/2);
    const y = Math.round((qrPx - s)/2);

    const pad = Math.round(s * 0.18);
    const bx = x - pad, by = y - pad, bw = s + 2*pad, bh = s + 2*pad;

    let drawBg = true;
    let bgColor = "#ffffff";
    if (elLogoBgMode.value === "transparent") drawBg = false;
    else if (elLogoBgMode.value === "custom") bgColor = elLogoBg.value;

    if (drawBg){
      const shape = elLogoBgShape.value;
      if (shape === "circle"){
        const cx = bx + bw/2, cy = by + bh/2, r = Math.min(bw,bh)/2;
        parts.push(`<circle cx="${cx}" cy="${cy}" r="${r}" fill="${escAttr(bgColor)}"/>`);
      } else if (shape === "rounded"){
        const pct = (parseInt(elLogoBgRound.value, 10) || 18)/100;
        const rr = Math.round(Math.min(bw,bh) * pct);
        parts.push(svgPath(svgRoundRectPath(bx, by, bw, bh, rr), bgColor));
      } else {
        parts.push(svgRect(bx, by, bw, bh, bgColor));
      }
    }

    parts.push(`<image x="${x}" y="${y}" width="${s}" height="${s}" href="${escAttr(logoDataUrl)}" preserveAspectRatio="xMidYMid meet"/>`);
  }

  function buildQrSvg(text, sizePx, ecLevel, dark, light, quietZone){
    const qr = qrcode(0, ecLevel);
    qr.addData(text);
    qr.make();

    const n = qr.getModuleCount();
    const qz = Math.max(0, parseInt(quietZone, 10) || 4);

    const totalModules = n + 2*qz;
    const m = Math.floor(sizePx / totalModules) || 1;
    const qrPx = totalModules * m;

    const startX = qz * m;
    const startY = qz * m;

    const parts = [];
    parts.push(`<svg xmlns="http://www.w3.org/2000/svg" width="${qrPx}" height="${qrPx}" viewBox="0 0 ${qrPx} ${qrPx}" shape-rendering="crispEdges">`);
    parts.push(svgRect(0,0,qrPx,qrPx,light));

    const doRound = (elRoundModules.value === "on");
    const rr = Math.round((parseFloat(elModuleRound.value || "0.18")) * m);

    for (let r=0; r<n; r++){
      for (let c=0; c<n; c++){
        if (!qr.isDark(r,c)) continue;
        if (inFinderOrSeparatorArea(r,c,n)) continue;

        const x = startX + c*m;
        const y = startY + r*m;

        if (!doRound){
          parts.push(svgRect(x,y,m,m,dark));
          continue;
        }

        const neighbors = countDarkNeighbors(qr, r, c, n);
        if (neighbors >= 2 && rr > 0){
          parts.push(svgPath(svgRoundRectPath(x,y,m,m,rr), dark));
        } else {
          parts.push(svgRect(x,y,m,m,dark));
        }
      }
    }

    drawEyes(parts, startX, startY, m, n, dark, light);
    drawLogo(parts, qrPx);

    parts.push(`</svg>`);
    return { svg: parts.join(""), pixelSize: qrPx, moduleSize: m, moduleCount: n, quietZone: qz };
  }

  function renderInto(box, svgString){
    clearNode(box);
    box.insertAdjacentHTML("beforeend", svgString);
  }

  // Last exports
  let lastBigSvg = "";
  let lastBigPx = 0;

  function renderAll(){
    const value = (elText.value || "").trim() || " ";
    const size = parseInt(elSize.value, 10) || 512;
    const smallSize = Math.min(320, size);

    const dark = elDark.value || "#000000";
    const light= elLight.value || "#ffffff";
    const ec = elEC.value || "H";
    const qz = elQuiet.value || "4";

    const small = buildQrSvg(value, smallSize, ec, dark, light, qz);
    const big   = buildQrSvg(value, size, ec, dark, light, qz);

    renderInto(boxSmall, small.svg);
    renderInto(boxBig, big.svg);

    lastBigSvg = big.svg;
    lastBigPx = big.pixelSize;

    hintEl.textContent = logoEnabled ? "Logo charg√© (DataURL)." : "Aucun logo (optionnel).";
    statusEl.textContent = `OK ‚Äî ${big.moduleCount} modules ‚Ä¢ module=${big.moduleSize}px ‚Ä¢ quiet=${big.quietZone} ‚Ä¢ sortie=${big.pixelSize}px`;
  }

  function downloadSVG(){
    if (!lastBigSvg){
      statusEl.textContent = "SVG non pr√™t. Clique sur G√©n√©rer.";
      return;
    }
    const blob = new Blob([lastBigSvg], { type: "image/svg+xml;charset=utf-8" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "qrcode.svg";
    a.click();
    setTimeout(() => URL.revokeObjectURL(url), 400);
    statusEl.textContent = "SVG t√©l√©charg√©.";
  }

  // ‚úÖ Export PNG from SVG (rasterize)
  async function downloadPNG(){
    if (!lastBigSvg || !lastBigPx){
      statusEl.textContent = "PNG non pr√™t. Clique sur G√©n√©rer.";
      return;
    }

    const scale = parseInt(elPngScale.value, 10) || 2;
    const w = lastBigPx * scale;
    const h = lastBigPx * scale;

    // SVG -> Blob URL
    const svgBlob = new Blob([lastBigSvg], { type: "image/svg+xml;charset=utf-8" });
    const svgUrl = URL.createObjectURL(svgBlob);

    // Draw into canvas
    const img = new Image();
    // IMPORTANT: keep same-origin by using blob URL; no crossOrigin needed
    img.onload = () => {
      const canvas = document.createElement("canvas");
      canvas.width = w;
      canvas.height = h;

      const ctx = canvas.getContext("2d");
      // no smoothing for crisp modules
      ctx.imageSmoothingEnabled = false;
      ctx.webkitImageSmoothingEnabled = false;
      ctx.mozImageSmoothingEnabled = false;

      ctx.drawImage(img, 0, 0, w, h);

      URL.revokeObjectURL(svgUrl);

      const a = document.createElement("a");
      a.download = `qrcode_${w}x${h}.png`;
      a.href = canvas.toDataURL("image/png");
      a.click();

      statusEl.textContent = `PNG t√©l√©charg√© (${w}√ó${h}).`;
    };

    img.onerror = () => {
      URL.revokeObjectURL(svgUrl);
      statusEl.textContent = "Erreur : impossible de rasteriser le SVG en PNG.";
    };

    img.src = svgUrl;
  }

  function readFileAsDataURL(file){
    return new Promise((resolve, reject) => {
      const r = new FileReader();
      r.onload = () => resolve(String(r.result || ""));
      r.onerror = reject;
      r.readAsDataURL(file);
    });
  }

  async function loadLogoFromFile(file){
    if (!file){
      logoEnabled = false;
      logoDataUrl = "";
      renderAll();
      return;
    }
    try{
      logoDataUrl = await readFileAsDataURL(file);
      logoEnabled = true;
      statusEl.textContent = "Logo charg√©.";
      renderAll();
    } catch(e){
      logoEnabled = false;
      logoDataUrl = "";
      statusEl.textContent = "Impossible de charger le logo.";
      renderAll();
    }
  }

  function resetAll(){
    elText.value = "https://fr1255.github.io/maker-lab-mouton-5-pattes/";
    elSize.value = "512";
    elEC.value = "H";
    elDark.value = "#e7eef7";
    elLight.value = "#0b0f14";
    elQuiet.value = "4";
    elEyeRound.value = "0.38";

    elRoundModules.value = "off";
    elModuleRound.value = "0.18";

    elLogoFile.value = "";
    elLogoSize.value = "25";
    elLogoBgMode.value = "auto";
    elLogoBg.value = "#ffffff";
    elLogoBgShape.value = "rounded";
    elLogoBgRound.value = "18";

    elPngScale.value = "2";

    logoEnabled = false;
    logoDataUrl = "";

    statusEl.textContent = "R√©initialis√©.";
    hintEl.textContent = "‚Äî";
    renderAll();
  }

  // Events
  btnGenerate.addEventListener("click", renderAll);
  btnDownloadSvg.addEventListener("click", downloadSVG);
  btnDownloadPng.addEventListener("click", downloadPNG);
  btnReset.addEventListener("click", resetAll);

  btnCopy.addEventListener("click", (e) => {
    e.preventDefault();
    navigator.clipboard?.writeText(elText.value || "").then(() => {
      statusEl.textContent = "Texte copi√©.";
    }).catch(() => {
      statusEl.textContent = "Copie impossible (permissions).";
    });
  });

  elLogoFile.addEventListener("change", () => {
    const file = elLogoFile.files && elLogoFile.files[0];
    loadLogoFromFile(file);
  });

  const live = [
    elText, elSize, elEC, elDark, elLight, elQuiet, elEyeRound,
    elRoundModules, elModuleRound,
    elLogoSize, elLogoBgMode, elLogoBg, elLogoBgShape, elLogoBgRound,
    elPngScale
  ];
  live.forEach(el => {
    el.addEventListener("input", renderAll);
    el.addEventListener("change", renderAll);
  });
  elText.addEventListener("keydown", (e) => { if (e.key === "Enter") renderAll(); });

  // Init
  renderAll();
</script>
</body>
</html>
